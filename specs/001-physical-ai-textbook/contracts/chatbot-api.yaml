# API Contract for RAG Chatbot

## Overview
The RAG (Retrieval-Augmented Generation) chatbot provides an interface for users to ask questions about the textbook content and receive answers grounded in the textbook material.

## Base URL
`https://your-textbook-domain.com/api/chatbot`

## Endpoints

### 1. Ask a Question
**POST** `/v1/question`

#### Description
Submit a question to the RAG chatbot and receive a response based on textbook content.

#### Request
```json
{
  "question": "string (required) - The question to ask",
  "selectedText": "string (optional) - Text selected by the user for context",
  "userId": "string (optional) - User identifier if available"
}
```

#### Response (200 OK)
```json
{
  "responseId": "string - Unique identifier for this response",
  "question": "string - The original question",
  "answer": "string - The answer generated by the chatbot",
  "sourceContent": [
    {
      "title": "string - Title of the source content",
      "section": "string - Section where the information was found",
      "relevance": "number - Relevance score from 0-1"
    }
  ],
  "timestamp": "string - ISO 8601 timestamp",
  "confidence": "number - Confidence score from 0-1"
}
```

#### Error Responses
- `400 Bad Request`: Invalid request format
- `429 Too Many Requests`: Rate limit exceeded
- `500 Internal Server Error`: Server error processing request

### 2. Get Answer Feedback
**POST** `/v1/feedback`

#### Description
Submit feedback on the quality of a chatbot response.

#### Request
```json
{
  "responseId": "string (required) - The ID of the response being rated",
  "rating": "number (required) - Rating from 1-5",
  "comment": "string (optional) - Additional feedback comment",
  "userId": "string (optional) - User identifier if available"
}
```

#### Response (200 OK)
```json
{
  "success": "boolean - Whether the feedback was recorded successfully"
}
```

### 3. Get Chat History
**GET** `/v1/history/{userId}`

#### Description
Retrieve a user's chat history with the textbook content.

#### Parameters
- `userId`: string (required) - The user's identifier

#### Response (200 OK)
```json
{
  "history": [
    {
      "question": "string - The question asked",
      "answer": "string - The answer provided",
      "timestamp": "string - ISO 8601 timestamp",
      "responseId": "string - Unique identifier for this response"
    }
  ]
}
```

### 4. Search Textbook Content
**POST** `/v1/search`

#### Description
Search for specific content within the textbook.

#### Request
```json
{
  "query": "string (required) - The search query",
  "maxResults": "number (optional) - Maximum number of results (default 10)",
  "userId": "string (optional) - User identifier if available"
}
```

#### Response (200 OK)
```json
{
  "results": [
    {
      "title": "string - Title of the content section",
      "content": "string - Excerpt from the content",
      "sectionPath": "string - Path to the section in the textbook",
      "relevance": "number - Relevance score from 0-1"
    }
  ],
  "totalResults": "number - Total number of results found"
}
```

## Authentication
Some endpoints may require authentication using API keys passed in the `Authorization` header:

```
Authorization: Bearer {api_key}
```

## Rate Limiting
To ensure fair usage, the API implements rate limiting:
- Unauthenticated requests: 100 requests per hour
- Authenticated requests: 1000 requests per hour

## Data Validation
All text inputs are: 
- Limited to 5000 characters
- Sanitized to prevent code injection
- Validated for UTF-8 encoding